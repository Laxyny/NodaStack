<Window x:Class="NodaStack.MonitoringWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:ui="http://schemas.modernwpf.com/2019"
        xmlns:converters="clr-namespace:NodaStack.Converters"
        xmlns:local="clr-namespace:NodaStack"
        Title="NodaStack Monitoring"
        Height="700"
        Width="1200"
        MinHeight="600"
        MinWidth="900"
        WindowStartupLocation="CenterOwner"
        Background="{DynamicResource ApplicationPageBackgroundThemeBrush}"
        ui:WindowHelper.UseModernWindowStyle="True">

    <Window.Resources>
        <converters:BoolToColorConverter x:Key="BoolToColorConverter"/>
        <converters:LogLevelToColorConverter x:Key="LogLevelToColorConverter"/>
        <converters:StatusToColorConverter x:Key="StatusToColorConverter"/>
        <converters:CpuUsageToColorConverter x:Key="CpuUsageToColorConverter"/>
        <converters:MemoryUsageToColorConverter x:Key="MemoryUsageToColorConverter"/>
        <local:BytesToStringConverter x:Key="BytesToStringConverter"/>
        
        <Style x:Key="MetricCardStyle" TargetType="Border">
            <Setter Property="Background" Value="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource SystemControlForegroundChromeDisabledLowBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="16"/>
            <Setter Property="Margin" Value="8"/>
        </Style>

        <Style x:Key="StatusIndicatorStyle" TargetType="Ellipse">
            <Setter Property="Width" Value="12"/>
            <Setter Property="Height" Value="12"/>
            <Setter Property="Margin" Value="0,0,8,0"/>
        </Style>

        <Style x:Key="MetricValueStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="24"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="{DynamicResource SystemControlForegroundBaseHighBrush}"/>
            <Setter Property="HorizontalAlignment" Value="Center"/>
        </Style>

        <Style x:Key="MetricLabelStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Foreground" Value="{DynamicResource SystemControlForegroundBaseMediumBrush}"/>
            <Setter Property="HorizontalAlignment" Value="Center"/>
            <Setter Property="Margin" Value="0,4,0,0"/>
        </Style>
    </Window.Resources>

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0"
                Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}"
                BorderBrush="{DynamicResource SystemControlForegroundChromeDisabledLowBrush}"
                BorderThickness="1"
                CornerRadius="8"
                Padding="20"
                Margin="0,0,0,16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0">
                    <TextBlock Text="ðŸ“Š System Monitoring"
                               FontSize="20"
                               FontWeight="SemiBold"
                               Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}"/>
                    <TextBlock x:Name="LastUpdatedText"
                               Text="Last updated: Never"
                               FontSize="12"
                               Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                               Margin="0,4,0,0"/>
                </StackPanel>

                <StackPanel Grid.Column="1"
                            Orientation="Horizontal">
                    <Button x:Name="RefreshButton"
                            Width="100"
                            Height="32"
                            Content="ðŸ”„ Refresh"
                            Margin="0,0,8,0"
                            Click="RefreshButton_Click"
                            Style="{StaticResource DefaultButtonStyle}"/>
                    <Button x:Name="ClearLogsButton"
                            Width="100"
                            Height="32"
                            Content="ðŸ—‘ï¸ Clear Logs"
                            Click="ClearLogsButton_Click"
                            Style="{StaticResource DefaultButtonStyle}"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Main Content -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Left Panel - Services and System Metrics -->
            <Grid Grid.Column="0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- System Metrics Cards -->
                <ScrollViewer Grid.Row="0"
                              HorizontalScrollBarVisibility="Auto"
                              VerticalScrollBarVisibility="Disabled"
                              Margin="0,0,0,16">
                    <StackPanel Orientation="Horizontal">
                        <!-- CPU Usage -->
                        <Border Style="{StaticResource MetricCardStyle}" Width="150">
                            <StackPanel>
                                <TextBlock Text="CPU Usage"
                                           Style="{StaticResource MetricLabelStyle}"/>
                                <TextBlock x:Name="CpuUsageText"
                                           Text="0%"
                                           Style="{StaticResource MetricValueStyle}"/>
                                <ProgressBar x:Name="CpuProgressBar"
                                            Height="8"
                                            Margin="0,8,0,0"
                                            Maximum="100"
                                            Value="0"/>
                            </StackPanel>
                        </Border>

                        <!-- Memory Usage -->
                        <Border Style="{StaticResource MetricCardStyle}" Width="150">
                            <StackPanel>
                                <TextBlock Text="Memory Usage"
                                           Style="{StaticResource MetricLabelStyle}"/>
                                <TextBlock x:Name="MemoryUsageText"
                                           Text="0 MB"
                                           Style="{StaticResource MetricValueStyle}"/>
                                <ProgressBar x:Name="MemoryProgressBar"
                                            Height="8"
                                            Margin="0,8,0,0"
                                            Maximum="100"
                                            Value="0"/>
                            </StackPanel>
                        </Border>

                        <!-- Disk Usage -->
                        <Border Style="{StaticResource MetricCardStyle}" Width="150">
                            <StackPanel>
                                <TextBlock Text="Disk Usage"
                                           Style="{StaticResource MetricLabelStyle}"/>
                                <TextBlock x:Name="DiskUsageText"
                                           Text="0 GB"
                                           Style="{StaticResource MetricValueStyle}"/>
                                <ProgressBar x:Name="DiskProgressBar"
                                            Height="8"
                                            Margin="0,8,0,0"
                                            Maximum="100"
                                            Value="0"/>
                            </StackPanel>
                        </Border>

                        <!-- Active Connections -->
                        <Border Style="{StaticResource MetricCardStyle}" Width="150">
                            <StackPanel>
                                <TextBlock Text="Connections"
                                           Style="{StaticResource MetricLabelStyle}"/>
                                <TextBlock x:Name="ConnectionsText"
                                           Text="0"
                                           Style="{StaticResource MetricValueStyle}"/>
                                <TextBlock Text="Active"
                                           Style="{StaticResource MetricLabelStyle}"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>

                <!-- Services Status -->
                <Border Grid.Row="1"
                        Style="{StaticResource MetricCardStyle}"
                        Margin="0,0,8,0">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0"
                                   Text="ðŸ–¥ï¸ Services Status"
                                   FontSize="16"
                                   FontWeight="SemiBold"
                                   Margin="0,0,0,16"
                                   Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}"/>

                        <ListView x:Name="ServicesListView"
                                  Grid.Row="1"
                                  Background="Transparent"
                                  BorderThickness="0"
                                  Style="{StaticResource DefaultListViewStyle}">
                            <ListView.View>
                                <GridView>
                                    <GridViewColumn Header="Service" Width="120">
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <StackPanel Orientation="Horizontal">
                                                    <Ellipse x:Name="StatusIndicator"
                                                             Style="{StaticResource StatusIndicatorStyle}"
                                                             Fill="{Binding IsHealthy, Converter={StaticResource BoolToColorConverter}}"/>
                                                    <TextBlock Text="{Binding Name}"
                                                               VerticalAlignment="Center"
                                                               FontWeight="SemiBold"/>
                                                </StackPanel>
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>
                                    <GridViewColumn Header="Status" Width="80" DisplayMemberBinding="{Binding Status}"/>
                                    <GridViewColumn Header="CPU %" Width="80" DisplayMemberBinding="{Binding CpuUsage, StringFormat='{}{0:F1}%'}"/>
                                    <GridViewColumn Header="Memory" Width="100" DisplayMemberBinding="{Binding MemoryUsage, Converter={StaticResource BytesToStringConverter}}"/>
                                    <GridViewColumn Header="Uptime" Width="100" DisplayMemberBinding="{Binding Uptime}"/>
                                    <GridViewColumn Header="Version" Width="80" DisplayMemberBinding="{Binding Version}"/>
                                    <GridViewColumn Header="Port" Width="60" DisplayMemberBinding="{Binding Port}"/>
                                </GridView>
                            </ListView.View>
                        </ListView>
                    </Grid>
                </Border>

                <!-- Port Scanner -->
                <Border Grid.Row="2"
                        Style="{StaticResource MetricCardStyle}"
                        Margin="0,8,8,0">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0"
                                   Text="ðŸ” Port Scanner"
                                   FontSize="16"
                                   FontWeight="SemiBold"
                                   Margin="0,0,0,12"
                                   Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}"/>

                        <StackPanel Grid.Row="1"
                                    Orientation="Horizontal"
                                    HorizontalAlignment="Center"
                                    Margin="0,0,0,12">
                            <TextBlock Text="Port Range:"
                                       VerticalAlignment="Center"
                                       FontWeight="SemiBold"
                                       FontSize="13"
                                       Margin="0,0,8,0"
                                       Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}"/>
                            <TextBox x:Name="StartPortTextBox"
                                     Width="80"
                                     Height="32"
                                     Text="8000"
                                     FontSize="13"
                                     Style="{StaticResource DefaultTextBoxStyle}"/>
                            <TextBlock Text="to"
                                       VerticalAlignment="Center"
                                       Margin="8,0"
                                       Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"/>
                            <TextBox x:Name="EndPortTextBox"
                                     Width="80"
                                     Height="32"
                                     Text="9000"
                                     FontSize="13"
                                     Style="{StaticResource DefaultTextBoxStyle}"/>
                            <Button x:Name="ScanPortsButton"
                                    Width="100"
                                    Height="32"
                                    Content="ðŸ” Scan Ports"
                                    Margin="12,0,0,0"
                                    Click="ScanPortsButton_Click"
                                    Style="{StaticResource DefaultButtonStyle}"/>
                        </StackPanel>

                        <ListView x:Name="PortsListView"
                                  Grid.Row="2"
                                  Background="Transparent"
                                  BorderThickness="0"
                                  Style="{StaticResource DefaultListViewStyle}">
                            <ListView.View>
                                <GridView>
                                    <GridViewColumn Header="Port" Width="80" DisplayMemberBinding="{Binding Port}"/>
                                    <GridViewColumn Header="Status" Width="100">
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <StackPanel Orientation="Horizontal">
                                                    <Ellipse Width="8" Height="8" Margin="0,0,6,0"
                                                             Fill="{Binding IsOpen, Converter={StaticResource BoolToColorConverter}}"/>
                                                    <TextBlock Text="{Binding Status}" VerticalAlignment="Center"/>
                                                </StackPanel>
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>
                                    <GridViewColumn Header="Service" Width="120" DisplayMemberBinding="{Binding Service}"/>
                                    <GridViewColumn Header="Description" Width="200" DisplayMemberBinding="{Binding Description}"/>
                                    <GridViewColumn Header="Protocol" Width="80" DisplayMemberBinding="{Binding Protocol}"/>
                                </GridView>
                            </ListView.View>
                        </ListView>
                    </Grid>
                </Border>
            </Grid>

            <!-- Right Panel - Logs -->
            <Border Grid.Column="1"
                    Style="{StaticResource MetricCardStyle}"
                    Margin="8,0,0,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0"
                               Text="ðŸ“‹ System Logs"
                               FontSize="16"
                               FontWeight="SemiBold"
                               Margin="0,0,0,12"
                               Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}"/>

                    <!-- Log Filters -->
                    <StackPanel Grid.Row="1"
                                Orientation="Horizontal"
                                Margin="0,0,0,12">
                        <TextBlock Text="Level:"
                                   VerticalAlignment="Center"
                                   FontWeight="SemiBold"
                                   FontSize="12"
                                   Margin="0,0,8,0"
                                   Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}"/>
                        <ComboBox x:Name="LevelFilterComboBox"
                                  Width="80"
                                  Height="28"
                                  FontSize="12"
                                  Style="{StaticResource DefaultComboBoxStyle}">
                            <ComboBoxItem Content="All"/>
                            <ComboBoxItem Content="Error"/>
                            <ComboBoxItem Content="Warning"/>
                            <ComboBoxItem Content="Info"/>
                            <ComboBoxItem Content="Debug"/>
                        </ComboBox>

                        <TextBlock Text="Service:"
                                   VerticalAlignment="Center"
                                   FontWeight="SemiBold"
                                   FontSize="12"
                                   Margin="16,0,8,0"
                                   Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}"/>
                        <ComboBox x:Name="ServiceFilterComboBox"
                                  Width="100"
                                  Height="28"
                                  FontSize="12"
                                  Style="{StaticResource DefaultComboBoxStyle}">
                            <ComboBoxItem Content="All"/>
                            <ComboBoxItem Content="Apache"/>
                            <ComboBoxItem Content="PHP"/>
                            <ComboBoxItem Content="MySQL"/>
                            <ComboBoxItem Content="phpMyAdmin"/>
                            <ComboBoxItem Content="System"/>
                        </ComboBox>
                    </StackPanel>

                    <ListView x:Name="LogsListView"
                              Grid.Row="2"
                              Background="Transparent"
                              BorderThickness="0"
                              Style="{StaticResource DefaultListViewStyle}">
                        <ListView.View>
                            <GridView>
                                <GridViewColumn Header="Time" Width="80">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding Timestamp, StringFormat='{}{0:HH:mm:ss}'}"
                                                       FontSize="11"/>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                                <GridViewColumn Header="Level" Width="60">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <Border Background="{Binding Level, Converter={StaticResource LogLevelToColorConverter}}"
                                                    CornerRadius="4"
                                                    Padding="4,2">
                                                <TextBlock Text="{Binding Level}"
                                                           FontSize="10"
                                                           FontWeight="SemiBold"
                                                           Foreground="White"
                                                           HorizontalAlignment="Center"/>
                                            </Border>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                                <GridViewColumn Header="Service" Width="80" DisplayMemberBinding="{Binding Service}"/>
                                <GridViewColumn Header="Message" Width="300" DisplayMemberBinding="{Binding Message}"/>
                            </GridView>
                        </ListView.View>
                    </ListView>
                </Grid>
            </Border>
        </Grid>
    </Grid>
</Window>