<Window x:Class="NodaStack.MonitoringWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:ui="http://schemas.modernwpf.com/2019"
        xmlns:converters="clr-namespace:NodaStack.Converters"
        xmlns:local="clr-namespace:NodaStack"
        Title="NodaStack Monitoring"
        Height="750"
        Width="1300"
        MinHeight="650"
        MinWidth="1000"
        WindowStartupLocation="CenterOwner"
        Background="{DynamicResource BackgroundBrush}"
        ui:WindowHelper.UseModernWindowStyle="True">

    <Window.Resources>
        <converters:BoolToColorConverter x:Key="BoolToColorConverter"/>
        <converters:LogLevelToColorConverter x:Key="LogLevelToColorConverter"/>
        <converters:StatusToColorConverter x:Key="StatusToColorConverter"/>
        <converters:CpuUsageToColorConverter x:Key="CpuUsageToColorConverter"/>
        <converters:MemoryUsageToColorConverter x:Key="MemoryUsageToColorConverter"/>
        <local:BytesToStringConverter x:Key="BytesToStringConverter"/>
    </Window.Resources>

    <Grid Margin="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Modern Header -->
        <Border Grid.Row="0"
                Style="{StaticResource ModernCardStyle}"
                Margin="0,0,0,20"
                Padding="24">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0">
                    <TextBlock Text="ðŸ“Š System Monitoring"
                               FontSize="22"
                               FontWeight="Bold"
                               Foreground="{DynamicResource TextPrimaryBrush}"/>
                    <TextBlock x:Name="LastUpdatedText"
                               Text="Last updated: Never"
                               FontSize="12"
                               Foreground="{DynamicResource TextSecondaryBrush}"
                               Margin="0,6,0,0"/>
                </StackPanel>

                <StackPanel Grid.Column="1"
                            Orientation="Horizontal">
                    <Button x:Name="RefreshButton"
                            Style="{StaticResource ModernButtonStyle}"
                            Width="120"
                            Height="40"
                            Margin="0,0,8,0"
                            Click="RefreshButton_Click">
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                            <TextBlock Text="ðŸ”„" FontSize="14" Margin="0,0,6,0"/>
                            <TextBlock Text="Refresh" FontWeight="SemiBold"/>
                        </StackPanel>
                    </Button>
                    <Button x:Name="ClearLogsButton"
                            Style="{StaticResource ModernSecondaryButtonStyle}"
                            Width="120"
                            Height="40"
                            Click="ClearLogsButton_Click">
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                            <TextBlock Text="ðŸ—‘ï¸" FontSize="14" Margin="0,0,6,0"/>
                            <TextBlock Text="Clear Logs" FontWeight="SemiBold"/>
                        </StackPanel>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Main Content -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Left Panel -->
            <Grid Grid.Column="0" Margin="0,0,12,0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- System Metrics Cards -->
                <ScrollViewer Grid.Row="0"
                              HorizontalScrollBarVisibility="Auto"
                              VerticalScrollBarVisibility="Disabled"
                              Margin="0,0,0,16">
                    <StackPanel Orientation="Horizontal">
                        <!-- CPU Usage -->
                        <Border Style="{StaticResource MetricCardStyle}" Width="170">
                            <StackPanel>
                                <TextBlock Text="CPU Usage"
                                           FontSize="12"
                                           Foreground="{DynamicResource TextSecondaryBrush}"
                                           HorizontalAlignment="Center"
                                           Margin="0,0,0,8"/>
                                <TextBlock x:Name="CpuUsageText"
                                           Text="0%"
                                           FontSize="28"
                                           FontWeight="Bold"
                                           Foreground="{DynamicResource TextPrimaryBrush}"
                                           HorizontalAlignment="Center"/>
                                <ProgressBar x:Name="CpuProgressBar"
                                            Height="10"
                                            Margin="0,12,0,0"
                                            Maximum="100"
                                            Value="0"
                                            Style="{StaticResource DefaultProgressBarStyle}"/>
                            </StackPanel>
                        </Border>

                        <!-- Memory Usage -->
                        <Border Style="{StaticResource MetricCardStyle}" Width="170">
                            <StackPanel>
                                <TextBlock Text="Memory Usage"
                                           FontSize="12"
                                           Foreground="{DynamicResource TextSecondaryBrush}"
                                           HorizontalAlignment="Center"
                                           Margin="0,0,0,8"/>
                                <TextBlock x:Name="MemoryUsageText"
                                           Text="0 MB"
                                           FontSize="28"
                                           FontWeight="Bold"
                                           Foreground="{DynamicResource TextPrimaryBrush}"
                                           HorizontalAlignment="Center"/>
                                <ProgressBar x:Name="MemoryProgressBar"
                                            Height="10"
                                            Margin="0,12,0,0"
                                            Maximum="100"
                                            Value="0"
                                            Style="{StaticResource DefaultProgressBarStyle}"/>
                            </StackPanel>
                        </Border>

                        <!-- Disk Usage -->
                        <Border Style="{StaticResource MetricCardStyle}" Width="170">
                            <StackPanel>
                                <TextBlock Text="Disk Usage"
                                           FontSize="12"
                                           Foreground="{DynamicResource TextSecondaryBrush}"
                                           HorizontalAlignment="Center"
                                           Margin="0,0,0,8"/>
                                <TextBlock x:Name="DiskUsageText"
                                           Text="0 GB"
                                           FontSize="28"
                                           FontWeight="Bold"
                                           Foreground="{DynamicResource TextPrimaryBrush}"
                                           HorizontalAlignment="Center"/>
                                <ProgressBar x:Name="DiskProgressBar"
                                            Height="10"
                                            Margin="0,12,0,0"
                                            Maximum="100"
                                            Value="0"
                                            Style="{StaticResource DefaultProgressBarStyle}"/>
                            </StackPanel>
                        </Border>

                        <!-- Active Connections -->
                        <Border Style="{StaticResource MetricCardStyle}" Width="170">
                            <StackPanel>
                                <TextBlock Text="Connections"
                                           FontSize="12"
                                           Foreground="{DynamicResource TextSecondaryBrush}"
                                           HorizontalAlignment="Center"
                                           Margin="0,0,0,8"/>
                                <TextBlock x:Name="ConnectionsText"
                                           Text="0"
                                           FontSize="28"
                                           FontWeight="Bold"
                                           Foreground="{DynamicResource TextPrimaryBrush}"
                                           HorizontalAlignment="Center"/>
                                <TextBlock Text="Active"
                                           FontSize="12"
                                           Foreground="{DynamicResource TextSecondaryBrush}"
                                           HorizontalAlignment="Center"
                                           Margin="0,8,0,0"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>

                <!-- Services Status -->
                <Border Grid.Row="1"
                        Style="{StaticResource ModernCardStyle}"
                        Margin="0,0,0,12">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0"
                                   Text="ðŸ–¥ï¸ Services Status"
                                   FontSize="18"
                                   FontWeight="Bold"
                                   Foreground="{DynamicResource TextPrimaryBrush}"
                                   Margin="0,0,0,16"/>

                        <Border Grid.Row="1"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource CardBorderBrush}"
                                BorderThickness="1"
                                CornerRadius="8"
                                Padding="8">
                            <ListView x:Name="ServicesListView"
                                      Background="Transparent"
                                      BorderThickness="0"
                                      Style="{StaticResource DefaultListViewStyle}">
                                <ListView.View>
                                    <GridView>
                                        <GridViewColumn Header="Service" Width="140">
                                            <GridViewColumn.CellTemplate>
                                                <DataTemplate>
                                                    <StackPanel Orientation="Horizontal">
                                                        <Ellipse Width="12" Height="12"
                                                                 Margin="0,0,8,0"
                                                                 Fill="{Binding IsHealthy, Converter={StaticResource BoolToColorConverter}}"
                                                                 Stroke="{DynamicResource CardBorderBrush}"
                                                                 StrokeThickness="2"/>
                                                        <TextBlock Text="{Binding Name}"
                                                                   VerticalAlignment="Center"
                                                                   FontWeight="SemiBold"/>
                                                    </StackPanel>
                                                </DataTemplate>
                                            </GridViewColumn.CellTemplate>
                                        </GridViewColumn>
                                        <GridViewColumn Header="Status" Width="100" DisplayMemberBinding="{Binding Status}"/>
                                        <GridViewColumn Header="CPU %" Width="90" DisplayMemberBinding="{Binding CpuUsage, StringFormat='{}{0:F1}%'}"/>
                                        <GridViewColumn Header="Memory" Width="120" DisplayMemberBinding="{Binding MemoryUsage, Converter={StaticResource BytesToStringConverter}}"/>
                                        <GridViewColumn Header="Uptime" Width="120" DisplayMemberBinding="{Binding Uptime}"/>
                                        <GridViewColumn Header="Version" Width="90" DisplayMemberBinding="{Binding Version}"/>
                                        <GridViewColumn Header="Port" Width="70" DisplayMemberBinding="{Binding Port}"/>
                                    </GridView>
                                </ListView.View>
                            </ListView>
                        </Border>
                    </Grid>
                </Border>

                <!-- Port Scanner -->
                <Border Grid.Row="2"
                        Style="{StaticResource ModernCardStyle}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0"
                                   Text="ðŸ” Port Scanner"
                                   FontSize="18"
                                   FontWeight="Bold"
                                   Foreground="{DynamicResource TextPrimaryBrush}"
                                   Margin="0,0,0,16"/>

                        <StackPanel Grid.Row="1"
                                    Orientation="Horizontal"
                                    HorizontalAlignment="Center"
                                    Margin="0,0,0,16">
                            <TextBlock Text="Port Range:"
                                       VerticalAlignment="Center"
                                       FontWeight="SemiBold"
                                       FontSize="13"
                                       Margin="0,0,8,0"
                                       Foreground="{DynamicResource TextPrimaryBrush}"/>
                            <TextBox x:Name="StartPortTextBox"
                                     Style="{StaticResource ModernTextBoxStyle}"
                                     Width="90"
                                     Height="36"
                                     Text="8000"
                                     FontSize="13"/>
                            <TextBlock Text="to"
                                       VerticalAlignment="Center"
                                       Margin="8,0"
                                       Foreground="{DynamicResource TextSecondaryBrush}"/>
                            <TextBox x:Name="EndPortTextBox"
                                     Style="{StaticResource ModernTextBoxStyle}"
                                     Width="90"
                                     Height="36"
                                     Text="9000"
                                     FontSize="13"/>
                            <Button x:Name="ScanPortsButton"
                                    Style="{StaticResource ModernButtonStyle}"
                                    Width="120"
                                    Height="36"
                                    Margin="12,0,0,0"
                                    Click="ScanPortsButton_Click">
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                    <TextBlock Text="ðŸ”" FontSize="12" Margin="0,0,4,0"/>
                                    <TextBlock Text="Scan Ports" FontWeight="SemiBold"/>
                                </StackPanel>
                            </Button>
                        </StackPanel>

                        <Border Grid.Row="2"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource CardBorderBrush}"
                                BorderThickness="1"
                                CornerRadius="8"
                                Padding="8">
                            <ListView x:Name="PortsListView"
                                      Background="Transparent"
                                      BorderThickness="0"
                                      Style="{StaticResource DefaultListViewStyle}">
                                <ListView.View>
                                    <GridView>
                                        <GridViewColumn Header="Port" Width="80" DisplayMemberBinding="{Binding Port}"/>
                                        <GridViewColumn Header="Status" Width="110">
                                            <GridViewColumn.CellTemplate>
                                                <DataTemplate>
                                                    <StackPanel Orientation="Horizontal">
                                                        <Ellipse Width="8" Height="8" Margin="0,0,6,0"
                                                                 Fill="{Binding IsOpen, Converter={StaticResource BoolToColorConverter}}"/>
                                                        <TextBlock Text="{Binding Status}" VerticalAlignment="Center"/>
                                                    </StackPanel>
                                                </DataTemplate>
                                            </GridViewColumn.CellTemplate>
                                        </GridViewColumn>
                                        <GridViewColumn Header="Service" Width="130" DisplayMemberBinding="{Binding Service}"/>
                                        <GridViewColumn Header="Description" Width="220" DisplayMemberBinding="{Binding Description}"/>
                                        <GridViewColumn Header="Protocol" Width="90" DisplayMemberBinding="{Binding Protocol}"/>
                                    </GridView>
                                </ListView.View>
                            </ListView>
                        </Border>
                    </Grid>
                </Border>
            </Grid>

            <!-- Right Panel - Logs -->
            <Border Grid.Column="1"
                    Style="{StaticResource ModernCardStyle}"
                    Margin="12,0,0,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0"
                               Text="ðŸ“‹ System Logs"
                               FontSize="18"
                               FontWeight="Bold"
                               Foreground="{DynamicResource TextPrimaryBrush}"
                               Margin="0,0,0,16"/>

                    <!-- Log Filters -->
                    <StackPanel Grid.Row="1"
                                Orientation="Horizontal"
                                Margin="0,0,0,16">
                        <TextBlock Text="Level:"
                                   VerticalAlignment="Center"
                                   FontWeight="SemiBold"
                                   FontSize="12"
                                   Margin="0,0,8,0"
                                   Foreground="{DynamicResource TextPrimaryBrush}"/>
                        <ComboBox x:Name="LevelFilterComboBox"
                                  Width="90"
                                  Height="32"
                                  FontSize="12"
                                  Style="{StaticResource DefaultComboBoxStyle}">
                            <ComboBoxItem Content="All"/>
                            <ComboBoxItem Content="Error"/>
                            <ComboBoxItem Content="Warning"/>
                            <ComboBoxItem Content="Info"/>
                            <ComboBoxItem Content="Debug"/>
                        </ComboBox>

                        <TextBlock Text="Service:"
                                   VerticalAlignment="Center"
                                   FontWeight="SemiBold"
                                   FontSize="12"
                                   Margin="16,0,8,0"
                                   Foreground="{DynamicResource TextPrimaryBrush}"/>
                        <ComboBox x:Name="ServiceFilterComboBox"
                                  Width="110"
                                  Height="32"
                                  FontSize="12"
                                  Style="{StaticResource DefaultComboBoxStyle}">
                            <ComboBoxItem Content="All"/>
                            <ComboBoxItem Content="Apache"/>
                            <ComboBoxItem Content="PHP"/>
                            <ComboBoxItem Content="MySQL"/>
                            <ComboBoxItem Content="phpMyAdmin"/>
                            <ComboBoxItem Content="System"/>
                        </ComboBox>
                    </StackPanel>

                    <Border Grid.Row="2"
                            Background="{DynamicResource SurfaceBrush}"
                            BorderBrush="{DynamicResource CardBorderBrush}"
                            BorderThickness="1"
                            CornerRadius="8"
                            Padding="8">
                        <ListView x:Name="LogsListView"
                                  Background="Transparent"
                                  BorderThickness="0"
                                  Style="{StaticResource DefaultListViewStyle}">
                            <ListView.View>
                                <GridView>
                                    <GridViewColumn Header="Time" Width="90">
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding Timestamp, StringFormat='{}{0:HH:mm:ss}'}"
                                                           FontSize="11"/>
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>
                                    <GridViewColumn Header="Level" Width="70">
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <Border Background="{Binding Level, Converter={StaticResource LogLevelToColorConverter}}"
                                                        CornerRadius="4"
                                                        Padding="6,3">
                                                    <TextBlock Text="{Binding Level}"
                                                               FontSize="10"
                                                               FontWeight="SemiBold"
                                                               Foreground="White"
                                                               HorizontalAlignment="Center"/>
                                                </Border>
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>
                                    <GridViewColumn Header="Service" Width="90" DisplayMemberBinding="{Binding Service}"/>
                                    <GridViewColumn Header="Message" Width="320" DisplayMemberBinding="{Binding Message}"/>
                                </GridView>
                            </ListView.View>
                        </ListView>
                    </Border>
                </Grid>
            </Border>
        </Grid>
    </Grid>
</Window>
